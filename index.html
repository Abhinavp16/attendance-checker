<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance Location Check</title>
    <!-- Link to the new front CSS -->
    <link rel="stylesheet" href="front.css">
</head>
<body>
    <div class="container" id="status-container">
        <h1>Checking Location</h1>
        <p>Please grant location permissions to continue.</p>
        <div class="spinner"></div>
    </div>

    <script>
        // --- YOUR DETAILS --- 

        // 1. Your classroom's coordinates (from Google Maps)
        const targetLatitude = 21.396219;
        const targetLongitude = 81.892669;

        // 2. Your NEW Microsoft Forms URL
        const formUrl = 'https://forms.cloud.microsoft/Pages/ResponsePage.aspx?id=dqBGjZPQbUGle4aSzeE7-P_Mrou4ewVKqgz44EPIev9UN0VXREhFUTAzRlpEWkdYV0VGQTY1T0tUNy4u';

        // 3. The allowed radius in meters
        const allowedRadiusInMeters = 28;

        // --- END OF SECTION TO EDIT ---

        function getDistance(lat1, lon1, lat2, lon2) {
            const R = 6371e3;
            const phi1 = lat1 * Math.PI / 180;
            const phi2 = lat2 * Math.PI / 180;
            const deltaPhi = (lat2 - lat1) * Math.PI / 180;
            const deltaLambda = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(deltaPhi / 2) * Math.sin(deltaPhi / 2) + Math.cos(phi1) * Math.cos(phi2) * Math.sin(deltaLambda / 2) * Math.sin(deltaLambda / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c;
        }

        function showError(message) {
            const container = document.getElementById('status-container');
            // Keep the structure generic so CSS applies correctly
            container.innerHTML = `<h1>Access Denied</h1><p>${message}</p>`;
        }

        function checkLocation() {
            if (!navigator.geolocation) {
                showError('Geolocation is not supported by your browser.');
                return;
            }
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const userLat = position.coords.latitude;
                    const userLon = position.coords.longitude;
                    const distance = getDistance(targetLatitude, targetLongitude, userLat, userLon);
                    if (distance <= allowedRadiusInMeters) {
                        window.location.href = formUrl;
                    } else {
                        showError('You are not within the required location for attendance. Please move closer and try again.');
                    }
                },
                (error) => {
                    // console.error(error); // Optional debugging
                    let msg = 'Unable to retrieve your location.';
                    if (error.code === 1) msg = 'Location permission denied. Please enable location services.';
                    else if (error.code === 2) msg = 'Location unavailable.';
                    else if (error.code === 3) msg = 'Location request timed out.';
                    showError(msg);
                },
                { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
            );
        }
        window.onload = checkLocation;
    </script>
</body>
</html>